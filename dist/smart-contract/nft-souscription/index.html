<!DOCTYPE html>
<html lang="fr">
	<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title -->
    <title>Gérer des souscriptions via des NFTs</title>
    <meta name="description" content="Tutoriel solidity expliquant comment gérer des souscriptions via l'aide de NFTs, avec la possibilité de renouveller la souscription périodiquement.">
    <link rel="stylesheet" href="/css/style.css">

    <!-- Responsive Stylesheet -->
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="sitemap" href="/sitemap-index.xml">
    <!-- Favicon -->
    <link rel="icon" href="/img/core-img/favicon.ico">
    <link rel="canonical" href="https://www.developpement-web3.fr/smart-contract/nft-souscription/">
 
 <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XNLXBTQEWJ"></script>

  
<script type="module" src="/_astro/hoisted.2ede0f3b.js"></script></head>
	<body>
		 
	   
    
        <!-- ##### Header Area Start ##### -->
    <nav class="navbar navbar-expand-lg navbar-white fixed-top" id="banner">
        <div class="container">
            <!-- Brand -->
            <a class="navbar-brand" href="/">Accueil</a>

            <!-- Toggler/collapsibe Button -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar links -->
            <div class="collapse navbar-collapse" id="collapsibleNavbar">

            </div>
        </div>
    </nav>
    <!-- ##### Header Area End ##### -->

    <!-- ##### Welcome Area Start ##### -->
    <div class="breadcumb-area">

        <!-- breadcumb content -->
        <div class="breadcumb-content">
            <div class="container h-100">
                <div class="row h-100 align-items-center">
                    <div class="col-12">
                        <nav aria-label="breadcrumb" class="breadcumb--con text-center">
                            <h2 class="w-text title wow fadeInUp" data-wow-delay="0.2s">Souscriptions renouvelables via NFT</h2>
                            <ol class="breadcrumb justify-content-center wow fadeInUp" data-wow-delay="0.4s">
                                <li class="breadcrumb-item"><a href="/">Accueil</a></li>
                                <li class="breadcrumb-item"><a href="/smart-contract-avec-solidity/">Smart
                                        contract</a></li>

                            </ol>
                        </nav>
                    </div>
                    <div class="col-12">
                        <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="csurbier" data-color="#5F7FFF" data-emoji="" data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#ffffff" data-coffee-color="#FFDD00"></script>
                          <a href="https://www.buymeacryptobeer.com/ChristopheSurbier" target="_blank"><img src="https://www.buymeacryptobeer.com/assets/images/logo/bigLogo.png" style="padding-top:10px;border-radius: 10px; height: 57px !important;width: 150px !important;" alt=""></a>
                      </div>
                      <div class="col-12">
                        <a style="color:white!important;font-size: 14px;" href="mailto:csurbier@idevotion.fr" target="_blank">M'écrire, me signaler une erreur?</a>
                      </div>
                      <div>

<!-- AddToAny BEGIN -->
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_email"></a>
    <a class="a2a_button_linkedin"></a>
    </div>
    
    <script async src="https://static.addtoany.com/menu/page.js"></script>
    <!-- AddToAny END -->
                      </div>
                </div>
            </div>
        </div>
    </div>
      <!-- ##### Blog Area Start ##### -->
      <section class="blog-area section-padding-100-85">
        <div class="container">

            <div class="row">
                
                <div class="col-12">
                    <div class="single-blog-area wow fadeInUp" data-wow-delay="0.2s">
                        <!-- Post Thumbnail -->
                        <div class="blog_thumbnail">
                            
                        </div>

                        <div class="blog-content">
                            <h2 id="définition">Définition</h2>
<p>Sur certains sites web3, le simple fait de posséder un NFT peut donner accès à certaines fonctionnalités du site. Nous allons voir dans ce tutoriel, comment pousser l’idée plus loin et utiliser les NFTs comme système d’abonnement.</p>
<p>Nous allons proposer deux types d’abonnement : mensuel ou annuel, ainsi que la possibilité pour l’utilisateur de renouveller son abonnement sans avoir à acheter un nouveau NFT.</p>
<h2 id="implémentation-dun-abonnement-via-nft">Implémentation d’un abonnement via NFT</h2>
<p><em>Le code source de cet article se trouve sur mon <a href="https://github.com/csurbier/tutoriels-developpement-web3">GitHub</a>.</em></p>
<p>Tout d’abord notre smart contract est un NFT classique de type ERC721 (mais la même logique peut s’appliquer sur un NFT de type ERC1155).</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// SPDX-License-Identifier: UNLICENSED</span></span>
<span class="line"><span style="color: #FF7B72">pragma</span><span style="color: #C9D1D9"> </span><span style="color: #7EE787">solidity</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">^0.8.18</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"@openzeppelin/contracts/access/Ownable.sol"</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"@openzeppelin/contracts/utils/Counters.sol"</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"@openzeppelin/contracts/security/ReentrancyGuard.sol"</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"@openzeppelin/contracts/token/ERC721/ERC721.sol"</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">contract</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">NftSubscriptionContract</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Ownable</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">ERC721</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">ReentrancyGuard</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">using</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Counters</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Counters</span><span style="color: #C9D1D9">.Counter;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">using</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Strings</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">uint256</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">   </span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> monthlyPrice </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ether</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> yearlyPrice </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">99</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ether</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    Counters.Counter </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> _tokenIds;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">enum</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">MemberType</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">MONTHLY</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">YEARLY</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">struct</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">MemberCard</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> tokenId;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> expDte;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> paid;</span></span>
<span class="line"><span style="color: #C9D1D9">        MemberType cardType;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> valid;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> owner;</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">mapping</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> MemberCard) </span><span style="color: #FF7B72">public</span><span style="color: #C9D1D9"> members;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">event</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">NewMemberCard</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">owner</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">paid</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">event</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">MemberCardRenewed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">owner</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">paid</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">   </span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">constructor</span><span style="color: #C9D1D9">() </span><span style="color: #D2A8FF">ERC721</span><span style="color: #C9D1D9">("NftSubscription", "NFTMEMBER") {}</span></span></code></pre>
<p>On définit un prix de 10 ETH pour l’abonnement mensuel et un prix de 99 ETH pour l’annuel (je sais c’est cher mais ce n’est pas le propos 😀).</p>
<p>Puis un type de souscription et une structure pour garder nos cartes de membres:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">enum</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">MemberType</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">MONTHLY</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">YEARLY</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">struct</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">MemberCard</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> tokenId;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> expDte;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> paid;</span></span>
<span class="line"><span style="color: #C9D1D9">        MemberType cardType;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> valid;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> owner;</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span></code></pre>
<p>La variable <strong>members</strong> est un mapping qui nous permet pour un <strong>tokenId</strong> (identifiant de NFT) la carte de membre associé.</p>
<p>Nous allons maintenant créer la méthode <strong>mintCard</strong> qui permet de créer un NFT ainsi que la carte de membre associé:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mintCard</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">MemberType</span><span style="color: #C9D1D9"> _cardType) </span><span style="color: #FF7B72">public</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">payable</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> price;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> expireDate;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_cardType </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> MemberType.MONTHLY) {</span></span>
<span class="line"><span style="color: #C9D1D9">            price </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> monthlyPrice;</span></span>
<span class="line"><span style="color: #C9D1D9">            expireDate </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">block</span><span style="color: #C9D1D9">.timestamp </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">31</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">days</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            price </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> yearlyPrice;</span></span>
<span class="line"><span style="color: #C9D1D9">            expireDate </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">block</span><span style="color: #C9D1D9">.timestamp </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">365</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">days</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">msg</span><span style="color: #C9D1D9">.value </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> price, </span><span style="color: #A5D6FF">"Payment value incorrect"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//Only one subscription/NFT per wallet </span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">balanceOf</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">msg.sender</span><span style="color: #C9D1D9">)</span><span style="color: #FF7B72">==</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">,</span><span style="color: #A5D6FF">"Already member please renew your subscription"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">mint</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">msg.sender</span><span style="color: #C9D1D9">, price, expireDate, _cardType);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span></code></pre>
<p>La fonction prend en argument le type de souscription que l’utilisateur souhaite (mensuel ou annuel) et en fonction on détermine la date d’expiration de la carte de membre et on vérifie si le paiement correspond.</p>
<p><em>Veuillez notez que pour simplifier les choses: 1 mois = 31 jours</em></p>
<p>La fonction <strong>mint</strong> reste classique et permet de “miner” le NFT mais crée aussi la carte de membre :</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mint</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> _to,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> _paid,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> _expireDate,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">MemberType</span><span style="color: #C9D1D9"> _cardType</span></span>
<span class="line"><span style="color: #C9D1D9">    ) </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> id </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _tokenIds.</span><span style="color: #D2A8FF">current</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        MemberCard </span><span style="color: #FF7B72">memory</span><span style="color: #C9D1D9"> _card;</span></span>
<span class="line"><span style="color: #C9D1D9">        _card.tokenId </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> id;</span></span>
<span class="line"><span style="color: #C9D1D9">        _card.expDte </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _expireDate;</span></span>
<span class="line"><span style="color: #C9D1D9">        _card.paid </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _paid;</span></span>
<span class="line"><span style="color: #C9D1D9">        _card.cardType </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _cardType;</span></span>
<span class="line"><span style="color: #C9D1D9">        _card.owner </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _to;</span></span>
<span class="line"><span style="color: #C9D1D9">        _card.valid </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">_mint</span><span style="color: #C9D1D9">(_to, id);</span></span>
<span class="line"><span style="color: #C9D1D9">        members[id] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _card;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">emit</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">NewMemberCard</span><span style="color: #C9D1D9">(_to, _paid);</span></span>
<span class="line"><span style="color: #C9D1D9">        _tokenIds.</span><span style="color: #D2A8FF">increment</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span></code></pre>
<p>Maintenant pour savoir si un utilisateur est abonné, il ne faut pas se contenter de vérifier qu’il possède un NFT mais de vérifier que ce dernier est toujours valide, c’est à dire que sa carte de membre n’a pas expiré:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getMemberCard</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">public</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">view</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">returns</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">MemberCard</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">memory</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> totalItemCount </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _tokenIds.</span><span style="color: #D2A8FF">current</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        MemberCard </span><span style="color: #FF7B72">memory</span><span style="color: #C9D1D9"> currentCard;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> totalItemCount; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (members[i].owner </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">msg.sender</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                currentCard </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> members[i];</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">block</span><span style="color: #C9D1D9">.timestamp </span><span style="color: #FF7B72">>=</span><span style="color: #C9D1D9"> currentCard.expDte) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    currentCard.valid </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">break</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> currentCard;</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span></code></pre>
<p>Ainsi pour un wallet connecté, en appelant cette fonction, notre frontend peut vérifier si il s’agit d’un membre ou non et si sa carte de membre est toujours valide (variable <strong>valid</strong>).</p>
<p><em>Il est bien sûr possible d’écrire une fonction qui pour un NFT donné (tokenId) renvoi directement la carte de membre.</em></p>
<h2 id="renouvellement-dun-abonnement-via-nft">Renouvellement d’un abonnement via NFT</h2>
<p>Une façon de gérer simplement un abonnement expiré, serait de demander à l’utilisateur d’acheter un nouveau NFT. <em>Cela nécessiterait d’adapter le code précédent qui part du principe qu’un utilisateur ne peut posséder qu’un seul abonnement/NFT.</em></p>
<p>Mais au lieu de cela, nous allons permettre à notre utilisateur de renouveller son abonnement, via une méthode <strong>renewSubscription</strong>:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">renewSubscription</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> _tokenId) </span><span style="color: #FF7B72">external</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">payable</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">_exists</span><span style="color: #C9D1D9">(_tokenId), </span><span style="color: #A5D6FF">"Membercard doesn't exists"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">        MemberCard </span><span style="color: #FF7B72">storage</span><span style="color: #C9D1D9"> currentMember </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> members[_tokenId];</span></span>
<span class="line"><span style="color: #C9D1D9">        </span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//Comment the following if you want anyone to be able to renew</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">// (gift,...)</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(currentMember.owner </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">msg.sender</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">"Not your membercard"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">       </span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> duration </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (currentMember.cardType </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> MemberType.MONTHLY) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(monthlyPrice </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">msg</span><span style="color: #C9D1D9">.value, </span><span style="color: #A5D6FF">"Payment value incorrect"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">            duration </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">block</span><span style="color: #C9D1D9">.timestamp </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">31</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">days</span><span style="color: #C9D1D9">; </span><span style="color: #8B949E">//month</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(yearlyPrice </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">msg</span><span style="color: #C9D1D9">.value, </span><span style="color: #A5D6FF">"Payment value incorrect"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">            duration </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">block</span><span style="color: #C9D1D9">.timestamp </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">365</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">days</span><span style="color: #C9D1D9">; </span><span style="color: #8B949E">//Year</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        currentMember.expDte </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> duration;</span></span>
<span class="line"><span style="color: #C9D1D9">        currentMember.paid </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">msg</span><span style="color: #C9D1D9">.value;</span></span>
<span class="line"><span style="color: #C9D1D9">        currentMember.valid </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">emit</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">MemberCardRenewed</span><span style="color: #C9D1D9">(currentMember.owner, currentMember.expDte);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span></code></pre>
<p>La méthode est assez simple. Tout d’abord elle vérifie que le NFT existe bien, puis elle regarde si le compte qui essaye de renouveller l’abonnement et bien celui qui le possède.</p>
<p><em>Comme indiqué en commentaire, il est aussi possible de faire sauter ce requirement afin que n’importe quel compte puisse renouveller un abonnement même si ce n’est pas le sien (cas d’un cadeau par exemple).</em></p>
<p>Enfin en fonction de l’abonnement choisi initialement (notez qu’il n’est ainsi pas possible de changer d’abonnement en cours de route), on vérifie le paiement et si tout est ok, on met à jour la date d’expiration de la carte de membre et on la repasse comme valide.</p>
<p>On peut gérer une augmentation de prix de l’abonnement en créeant une méthode:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// Method to update prices</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">changePrice</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">MemberType</span><span style="color: #C9D1D9"> _cardType,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">price</span></span>
<span class="line"><span style="color: #C9D1D9">    ) </span><span style="color: #FF7B72">external</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">onlyOwner</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_cardType </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> MemberType.MONTHLY) {</span></span>
<span class="line"><span style="color: #C9D1D9">            monthlyPrice </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> price;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            yearlyPrice </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> price;</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span></code></pre>
<h2 id="transfert-dun-nft-et-donc-de-labonnement">Transfert d’un NFT et donc de l’abonnement.</h2>
<p>Notre contrat posséde néanmoins une faille (ou pas). Si un utilisateur décide de vendre son NFT ou transfère son NFT à quelqu’un d’autre, l’abonnement lui ne sera pas transféré et le nouveau possesseur du NFT ne sera pas en mesure d’accèder aux fonctions membre du site.</p>
<p>En effet la méthode qui vérifie la carte de membre se base sur la variable <strong>owner</strong> de la carte:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9"> MemberCard </span><span style="color: #FF7B72">memory</span><span style="color: #C9D1D9"> currentCard;</span></span>
<span class="line"><span style="color: #C9D1D9">   </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (members[i].owner </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">msg.sender</span><span style="color: #C9D1D9">) </span></span></code></pre>
<p>Or dans le cas d’un transfert, cette variable n’est pas mise à jour et donc la carte de membre ne sera pas trouvée.</p>
<p>à vous de voir si c’est un problème ou non selon votre business. Si oui, il faut donc adapter le code pour gérer ce cas de figure.</p>
<p>Pour cela il faut adapter les méthodes standards du contrat ERC721 afin de gérer ce cas:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">safeTransferFrom</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">from</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">to</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">tokenId</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">bytes</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">memory</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">data</span></span>
<span class="line"><span style="color: #C9D1D9">    ) </span><span style="color: #FF7B72">public</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">virtual</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">override</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//call the original function that you wanted.</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">safeTransferFrom</span><span style="color: #C9D1D9">(from, to, tokenId, data);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//update</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> totalItemCount </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _tokenIds.</span><span style="color: #D2A8FF">current</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> totalItemCount; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (members[i].tokenId </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> tokenId) {</span></span>
<span class="line"><span style="color: #C9D1D9">                MemberCard </span><span style="color: #FF7B72">storage</span><span style="color: #C9D1D9"> currentItem </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> members[i];</span></span>
<span class="line"><span style="color: #C9D1D9">                currentItem.owner </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">payable</span><span style="color: #C9D1D9">(to);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">break</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">safeTransferFrom</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">from</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">to</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">tokenId</span></span>
<span class="line"><span style="color: #C9D1D9">    ) </span><span style="color: #FF7B72">public</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">virtual</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">override</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//call the original function that you wanted.</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">safeTransferFrom</span><span style="color: #C9D1D9">(from, to, tokenId);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//update</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> totalItemCount </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _tokenIds.</span><span style="color: #D2A8FF">current</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> totalItemCount; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (members[i].tokenId </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> tokenId) {</span></span>
<span class="line"><span style="color: #C9D1D9">                MemberCard </span><span style="color: #FF7B72">storage</span><span style="color: #C9D1D9"> currentItem </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> members[i];</span></span>
<span class="line"><span style="color: #C9D1D9">                currentItem.owner </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">payable</span><span style="color: #C9D1D9">(to);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">break</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">transferFrom</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">from</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">address</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">to</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">tokenId</span></span>
<span class="line"><span style="color: #C9D1D9">    ) </span><span style="color: #FF7B72">public</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">virtual</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">override</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//call the original function that you wanted.</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">transferFrom</span><span style="color: #C9D1D9">(from, to, tokenId);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #8B949E">//update</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> totalItemCount </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _tokenIds.</span><span style="color: #D2A8FF">current</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">uint256</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> totalItemCount; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (members[i].tokenId </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> tokenId) {</span></span>
<span class="line"><span style="color: #C9D1D9">                MemberCard </span><span style="color: #FF7B72">storage</span><span style="color: #C9D1D9"> currentItem </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> members[i];</span></span>
<span class="line"><span style="color: #C9D1D9">                currentItem.owner </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">payable</span><span style="color: #C9D1D9">(to);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">break</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span></code></pre>
<p>On re-écrit les fonctions standards permettant de transférer un NFT afin de retrouver la carte de membre correspondant à ce dernier, et de mémoriser le nouveau propriétaire du NFT.</p>
<p>Parfait passons maintenant à la suite: écrivons les tests afin de vérifier que notre smart contract fonctionne bien !</p>
<p><a href="/smart-contract/nft-souscription-tests/">Lire la suite</a></p>
<style>
    p { color: white;!important }
    a { color:darkorange!important}
  </style>
                         
                        </div>
                    </div>

                </div>


            </div>
        </div>
    </section>
    <!-- ##### Blog Area End ##### -->
		<footer class="footer-area bg-img" style="background-image: url(img/core-img/pattern.png);"> 
    <div class="footer-content-area "> 
        <div class="container"> 
            <div class="row">
              </div>
            <div class="row "> 
             
                <div class="col-12 col-lg-4 col-md-6"> 
                    <div class="footer-copywrite-info"> 
                        <!-- Copywrite -->                                 
                        <div class="copywrite_text fadeInUp" data-wow-delay="0.2s"> 
                            <div class="footer-logo"> 
                                
                            </div>    
                                                           
                            <p>Vous pouvez me retrouver sur :</p> 
                        </div>                                 
                        <!-- Social Icon -->                                 
                        <div class="footer-social-info fadeInUp" data-wow-delay="0.4s"> 
                           
                            <a href="https://twitter.com/csurbier"> <i class="fa fa-twitter" aria-hidden="true"></i></a> 
                            <a href="https://github.com/csurbier"><i class="fa fa-github" aria-hidden="true"></i></a> 
                            <a href="https://www.malt.fr/profile/christophesurbier"><i class="fa fa-slack" aria-hidden="true"></i></a> 
                            <a href="https://www.linkedin.com/in/christophesurbier/"><i class="fa fa-linkedin" aria-hidden="true"></i></a> 
                        </div>                                 
                    </div>                             
                </div>                         
                <div class="col-12 col-lg-3 col-md-6"> 
                    <div class="contact_info_area d-sm-flex justify-content-between"> 
                        <!-- Content Info -->                                 
                        <div class="contact_info mt-x text-center fadeInUp" data-wow-delay="0.3s"> 
                            
                        </div>                                 
                    </div>                             
                </div>                         
                <div class="col-12 col-lg-2 col-md-6 "> 
                    <!-- Content Info -->                             
                    <div class="contact_info_area d-sm-flex justify-content-between"> 
                        <div class="contact_info mt-s text-center fadeInUp" data-wow-delay="0.2s"> 
                           
                        </div>                                 
                    </div>                             
                </div>                         
                <div class="col-12 col-lg-3 col-md-6 "> 
                    <div class="contact_info_area d-sm-flex justify-content-between"> 
                        <!-- Content Info -->                                 
                        <div class="contact_info mt-s text-center fadeInUp" data-wow-delay="0.4s"> 
                            
                        </div>                                 
                    </div>                             
                </div>    
                <div class="col-12" style="font-size: 14px;">
                    Copyright © 2023. Created with ❤️ in Barcelona. Build proudly with <a style="color:white" href="https://astro.build/" target="_blank"><img style="width:20px" src="https://astro.build/favicon.svg" alt="Astro">Astro</a>
                </div>                     
            </div>                     
        </div>                 
    </div>             
</footer>     
          
<script src="/js/jquery.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/plugins.js"></script>
<script src="/js/script.js"></script>
	</body></html>